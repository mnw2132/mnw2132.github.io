---
title: "Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source: embed
---

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)
library(plotly)
library(stringr)

library(flexdashboard)
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart A

```{r}
data("instacart")

instacart_df = 
  instacart %>%
  na.omit(instacart) %>% #omitting any NA
  select(order_id, add_to_cart_order, reordered, user_id, order_dow, order_hour_of_day, product_name, department) %>% #Selecting variables
  filter(str_detect(product_name, "Organic"), reordered == "0", department %in% c("produce"), order_dow == "1") #Only 1st time orders, not re-orders will be shown. Remove any orders in departments that do not include edible items

unique(instacart_df$department)
```

# Plotly plots
## Scatterplot
```{r}
#Set up data for scatterplot
produce_1to5 <- instacart_df %>% 
  group_by(product_name) %>%   # Group by product name
  summarize(
    total_count = n(),    # Count total purchases of each product
    order_count = sum(add_to_cart_order %in% 1:5) # % where that was one of the 1st five products they put in their cart
  ) %>%
    filter(total_count > 1) %>% #Removed foods where there was only 0 or 1 bought because it was messing with the graph
  mutate(order_percent = (order_count / total_count) * 100) # Calculate percentage for the amount of orders


produce_1to5 %>%
  mutate(text_label = str_c("Product Name:", product_name)) %>%
  plot_ly(x = ~total_count, y = ~order_percent, color = ~product_name, type = "scatter", mode = "markers", colors = "viridis") #when the legend is on there, it only shows the legend in website, not the graph itself
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart B

```{r}
instacart_df %>%
  count(product_name) %>%
  mutate(product_name = fct_reorder(product_name, n)) %>%
  plot_ly( 
    x = ~product_name, y = ~n, 
    color = ~product_name, type = "bar", colors = "viridis")
```

### Chart C

```{r}

```

